<!DOCTYPE html><!--[if lt IE 8]><html lang="en" class="ie"><![endif]--><!--[if gt IE 8]><!--><html lang="en"><!--<![endif]--><head><meta charset="utf-8"><title>MOLGENIS - How does it work?</title><meta name="description" content="Interesting things to know about Compute"><meta name="author" content="MOLGENIS community"><meta name="handheldfriendly" content="true"><meta name="mobileoptimized" content="320"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta http-equiv="cleartype" content="on"><script src="/res/js/jquery-1.11.3.min.js"> </script><script src="/res/js/bootstrap.min.js"></script><link rel="stylesheet" href="/res/css/prism.css"><link rel="stylesheet" href="/res/css/application.css" type="text/css"><link rel="shortcut icon" href="/favicon.png" type="image/png"><link rel="alternate" type="application/rss+xml" href="/blog/feed.xml" title="undefined"></head><body><header class="molgenis-docs-header"><div role="navigation" class="navbar navbar-fixed-top"><div class="header-container"><div class="navbar-header"><button type="button" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar" class="navbar-toggle collapsed"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand active"><img src="/res/images/wordmark-blue.png" alt="undefined" class="wordmark"/></a></div><div class="collapse navbar-collapse">              <ul class="nav navbar-nav"><li><a href="/software">TOOLS</a></li><li><a href="/documentation">DOCUMENTATION</a></li><li class="active"><a href="/pipelines">PIPELINES</a></li><li><a href="/develop">DEVELOP</a></li><li><a href="/support">SUPPORT</a></li><li><a href="#searchbox" data-toggle="collapse"><i class="glyphicon glyphicon-search"></i></a></li></ul></div></div></div><div id="searchbox" class="collapse"><form role="search" action="/search-results"><input placeholder="Search" name="q" class="form-control"/></form></div><div class="molgenis-docs-titlebar active"><div class="container"> <h1>How does it work?</h1><p>Interesting things to know about Compute   </p></div></div></header><div class="molgenis-docs-body"><div class="container"><div class="row"><div role="complementary" class="col-md-3"><nav id="molgenis-docs-sidebar" class="molgenis-docs-sidebar hidden-print hidden-xs hidden-sm"><ul id="molgenis-docs-sidenav" class="nav molgenis-docs-sidenav"></ul></nav><script>$(function() {
    var sideNav = $("#molgenis-docs-sidenav");
    var index = 0;
    $(".row h1").each(function() {
        
        //create id for h1
        var id = (index++) + $(this).text().replace(/\s/gi,"-").replace(/\W/g,"").toLowerCase();
        $(this).prepend("<a name=\""+id+"\"></a>");
        
        //add h1 to list
        var li = $("<li><a href=\"#"+id+"\">"+$(this).text()+"</a></li>")
        sideNav.append(li);
        
        //wrap h1 into section
        var section = $(this).wrap("<section id=\""+id+"\"></section>").parent();
        
        //wrap parts of h1 into one section
        $(this).parent().nextUntil("h1").each(function(){            
            section.append($(this));
        });
        
        //repeat for h2
        if($("h2",$(this).parent()).length > 0) {
            var ul = $("<ul class=\"nav\"></ul>");
            li.append(ul);
            
            $("h2",$(this).parent()).each(function(){
            
                //create id for h2
                var id = (index++) + $(this).text().replace(/\s/gi,"-").replace(/\W/g,"").toLowerCase();
                $(this).prepend("<a name=\""+id+"\"></a>");
        
                //wrap h2 into section
                var section = $(this).wrap("<section id=\""+id+"\"></section>").parent();
        
                ul.append($("<li><a href=\"#"+id+"\">"+$(this).text()+"</a></li>"));
        
                //wrap parts of h2 into one section
                $(this).parent().nextUntil("h2").each(function(){            
                    section.append($(this));
                });
            

            });
        }
    });    
    
    //add "back to top"
    sideNav.append("<li><a href=\"#top\" style=\"font-size:smaller\">Back to top</a></li>");
    var $body   = $(document.body);
    
    //enable the 'active' highlighting using scrollspy plugin
    $('body').scrollspy({
        target: '#molgenis-docs-sidebar'
    });
    $('#molgenis-docs-sidebar').width($('#molgenis-docs-sidebar').parent().width());
    
    //enable affix
    $('#molgenis-docs-sidebar').affix({
        offset: {
            top: $('#molgenis-docs-sidebar').offset().top,
            bottom: $('.molgenis-docs-footer').outerHeight(true) + 10
        }
    });
    
    //resize affix box when window resizes
    $(window).resize(function () {
            $('.molgenis-docs-sidebar').width($('#molgenis-docs-sidebar').parent().width());
        });
    
    $("table").addClass("table table-bordered");
});</script></div><div role="main" class="col-md-9 contents"><h2>How does it work?</h2><h3>Parameters</h3><p>Parameters can be provided in text files, there are a couple of formats to choose from.</p>
<p>Say you want to specify the following four combinations of parameters:</p>
<table>
<thead>
<tr>
<th>project</th>
<th>dir</th>
<th>sample</th>
</tr>
</thead>
<tbody>
<tr>
<td>project1</td>
<td>dir1</td>
<td>sample1</td>
</tr>
<tr>
<td>project1</td>
<td>dir2</td>
<td>sample2</td>
</tr>
<tr>
<td>project1</td>
<td>dir2</td>
<td>sample3</td>
</tr>
<tr>
<td>project2</td>
<td>dir2</td>
<td>sample4</td>
</tr>
</tbody>
</table>
<p>We&#39;ll show how the following combination of parameters looks in each of the file formats.</p>
<h4>Table format</h4><p>This is an ordinary csv file with key names as headers on the first line.
The rest of the lines contain comma separated value combinations for those keys.</p>
<pre><code>project, dir, sample
project1, dir1, sample1
project1, dir2, sample2
project1, dir2, sample3
project2, dir2, sample4
</code></pre><p>This is a normal CSV file so you&#39;ll need to surround the cell value with quotes in the csv format if you want to put a comma in the value.</p>
<h4>Property format</h4><p>This is a property file with key names as keys and comma separated value combinations for each key as a value.
All value lists must be the same size</p>
<pre><code>project=project1,project1,project1,project2
dir=dir1,dir2,dir2,dir2
sample=sample1,sample2,sample3,sample4
</code></pre><p>This is parsed as a normal property file and the values are subsequently split on comma&#39;s (<code>,</code>).</p>
<h4>List parameter values</h4><p>A parameter value of the range format <code>i..j</code> will result in multiple rows, one for all values within the range.
So for example if you have provided (in any format) the parameter values</p>
<table>
<thead>
<tr>
<th>project</th>
<th>value</th>
</tr>
</thead>
<tbody>
<tr>
<td>project1</td>
<td>1..2</td>
</tr>
<tr>
<td>project2</td>
<td>1..3</td>
</tr>
</tbody>
</table>
<p>They will be expanded to</p>
<table>
<thead>
<tr>
<th>project</th>
<th>value</th>
</tr>
</thead>
<tbody>
<tr>
<td>project1</td>
<td>1</td>
</tr>
<tr>
<td>project1</td>
<td>2</td>
</tr>
<tr>
<td>project2</td>
<td>1</td>
</tr>
<tr>
<td>project2</td>
<td>2</td>
</tr>
<tr>
<td>project2</td>
<td>3</td>
</tr>
</tbody>
</table>
<p>Similarly, a parameter value with a comma-separated list of values will result in multiple rows, one for all values in the list. Surround the value with quotes to escape commas, e.g. <code>&quot;sample2,sample3&quot;</code>.</p>
<p>So </p>
<table>
<thead>
<tr>
<th>project</th>
<th>dir</th>
<th>sample</th>
</tr>
</thead>
<tbody>
<tr>
<td>project1</td>
<td>dir1</td>
<td>sample1</td>
</tr>
<tr>
<td>project1</td>
<td>dir2</td>
<td>sample2,sample3</td>
</tr>
<tr>
<td>project2</td>
<td>dir2</td>
<td>sample4</td>
</tr>
</tbody>
</table>
<p>Will be expanded to</p>
<table>
<thead>
<tr>
<th>project</th>
<th>dir</th>
<th>sample</th>
</tr>
</thead>
<tbody>
<tr>
<td>project1</td>
<td>dir1</td>
<td>sample1</td>
</tr>
<tr>
<td>project1</td>
<td>dir2</td>
<td>sample2</td>
</tr>
<tr>
<td>project1</td>
<td>dir2</td>
<td>sample3</td>
</tr>
<tr>
<td>project2</td>
<td>dir2</td>
<td>sample4</td>
</tr>
</tbody>
</table>
<h4>Multiple files</h4><p>You may specify multiple parameter files.
Each parameter may only be specified in one file.
The resulting list of parameters will be created by taking all possible combinations of parameter combinations from each file.</p>
<h4>Simple example</h4><p>Say we have the following parameter combinations:</p>
<table>
<thead>
<tr>
<th>input</th>
</tr>
</thead>
<tbody>
<tr>
<td>hello</td>
</tr>
<tr>
<td>bye</td>
</tr>
</tbody>
</table>
<p>and</p>
<table>
<thead>
<tr>
<th>workflowName</th>
<th>creationDate</th>
</tr>
</thead>
<tbody>
<tr>
<td>myFirstWorkflow</td>
<td>today</td>
</tr>
</tbody>
</table>
<p>Then these will get combined to </p>
<table>
<thead>
<tr>
<th>input</th>
<th>workflowName</th>
<th>creationDate</th>
</tr>
</thead>
<tbody>
<tr>
<td>hello</td>
<td>myFirstWorkflow</td>
<td>today</td>
</tr>
<tr>
<td>bye</td>
<td>myFirstWorkflow</td>
<td>today</td>
</tr>
</tbody>
</table>
<h4>Example with three files</h4><p>Say we have the following three files:</p>
<table>
<thead>
<tr>
<th>input</th>
</tr>
</thead>
<tbody>
<tr>
<td>hello</td>
</tr>
<tr>
<td>bye</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>sample</th>
</tr>
</thead>
<tbody>
<tr>
<td>sample1</td>
</tr>
<tr>
<td>sample2</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>workflowName</th>
<th>creationDate</th>
</tr>
</thead>
<tbody>
<tr>
<td>myFirstWorkflow</td>
<td>today</td>
</tr>
</tbody>
</table>
<p>Then these will get combined to </p>
<table>
<thead>
<tr>
<th>input</th>
<th>sample</th>
<th>workflowName</th>
<th>creationDate</th>
</tr>
</thead>
<tbody>
<tr>
<td>hello</td>
<td>sample1</td>
<td>myFirstWorkflow</td>
<td>today</td>
</tr>
<tr>
<td>hello</td>
<td>sample2</td>
<td>myFirstWorkflow</td>
<td>today</td>
</tr>
<tr>
<td>bye</td>
<td>sample1</td>
<td>myFirstWorkflow</td>
<td>today</td>
</tr>
<tr>
<td>bye</td>
<td>sample2</td>
<td>myFirstWorkflow</td>
<td>today</td>
</tr>
</tbody>
</table>
<h4>Collapsing (or Folding) the table of Parameter values</h4><p>Say we have the following combinations:</p>
<table>
<thead>
<tr>
<th>project</th>
<th>dir</th>
<th>sample</th>
</tr>
</thead>
<tbody>
<tr>
<td>project1</td>
<td>dir1</td>
<td>sample1</td>
</tr>
<tr>
<td>project1</td>
<td>dir2</td>
<td>sample2</td>
</tr>
<tr>
<td>project1</td>
<td>dir2</td>
<td>sample3</td>
</tr>
<tr>
<td>project2</td>
<td>dir2</td>
<td>sample4</td>
</tr>
</tbody>
</table>
<p>Now if a particular step&#39;s protocol depends only on the value of parameter <code>project</code>, it only needs to be run twice, once for <code>project=project1</code> and once for <code>project=project2</code>.
So the table of parameter combinations can be collapsed to the much smaller table.</p>
<table>
<thead>
<tr>
<th>project</th>
</tr>
</thead>
<tbody>
<tr>
<td>project1</td>
</tr>
<tr>
<td>project2</td>
</tr>
</tbody>
</table>
<p>If the step&#39;s protocol depends on parameters <code>project</code> and <code>dir</code>, three instances for the step need to be created, collapsing the table as follows:</p>
<table>
<thead>
<tr>
<th>project</th>
<th>dir</th>
</tr>
</thead>
<tbody>
<tr>
<td>project1</td>
<td>dir1</td>
</tr>
<tr>
<td>project1</td>
<td>dir2</td>
</tr>
<tr>
<td>project2</td>
<td>dir2</td>
</tr>
</tbody>
</table>
<p>The step need not be run for the combination <code>project=project2, dir=dir1</code>, since no parameter combinations exist with those values.</p>
<h4>environment files</h4><p>Data is shared between steps using env files.
Those contain entries of the shape <code>name[index]=value</code></p>
<p>Compute generates <code>user.env</code> which contains all inputs for all steps that are known at generation time.</p>
<p>At runtime, the steps may create files named <em>stepname</em>_<em>stepindex</em>.env. So for example <code>step1_0.sh</code> creates <code>step1_0.env</code>.</p>
<h4>Weaving</h4><p>Parameters which are known beforehand can also be <strong>weaved</strong> directly into the protocols
(if &#39;weave&#39; flag is set in command-line options). In our example, two shell scripts are generated
for &#39;step1&#39;. The weaved version of the generated files is shown below.</p>
<p>step1_0.sh:</p>
<pre><code class="language-bash">  #string in
  #output out
  # Let&#39;s do something with string &#39;in&#39;
  echo &quot;hello_hasBeenInStep1&quot;
  out=hello_hasBeenInStep1
</code></pre>
<p>and step1_1.sh</p>
<pre><code class="language-bash">  #string in
  #output out
  # Let&#39;s do something with string &#39;in&#39;
  echo &quot;bye_hasBeenInStep1&quot;
  out=bye_hasBeenInStep1
</code></pre>
<p>The output values of the first steps are not known beforehand, so, &#39;string&#39; cannot be weaved and will stay in the generated for the &#39;step2&#39; script as it was. However, the &#39;wf&#39; and &#39;date&#39; values are weaved.</p>
<p>step2_0.sh:</p>
<pre><code class="language-bash">  #string wf
  #string date
  #list strings
  echo &quot;Workflow name: myFirstWorkflow&quot;
  echo &quot;Created: today&quot;
  echo &quot;Result of step1.sh:&quot;
  for s in &quot;${strings[@]}&quot;
  do
      echo ${s}
  done
</code></pre>
<p>If values can be known, the script will have the following content </p>
<p>step2_0.sh with all known values:</p>
<pre><code class="language-bash">  #string wf
  #string date
  #list strings
  echo &quot;Workflow name: myFirstWorkflow&quot;
  echo &quot;Created: today&quot;
  echo &quot;Result of step1.sh:&quot;
  for s in &quot;hello&quot; &quot;bye&quot;
  do
      echo ${s}
  done
</code></pre>
<p>If &#39;weaved&#39; flag is not set, +step1_0.sh+ file, for example looks as follows:</p>
<pre><code class="language-bash">  # Connect parameters to environment
  input=&quot;bye&quot;
  #string input
  # Let&#39;s do something with string &#39;in&#39;
  echo &quot;${input}_hasBeenInStep1&quot;
  out=${input}_hasBeenInStep1
</code></pre>
<p>In this way, users can choose how generated files look like.
In the current implementation, values are first taken from parameter files. If they are not present, then compute looks,
if these values can be known at run-time, by analysing all previous steps of the protocol, where values are unknown.
If values cannot be known at run-time, compute will give a generation error. </p>
<h3>Protocol headers</h3><h4>Inputs and Outputs</h4><p>Each Protocol lists its Input parameters and its Output values in the header</p>
<pre><code>#string project
#string dir
#list sample
#output out1
#output out2
</code></pre><p>This header states that this Protocol depends on the values of three Input parameters named
<code>project</code>, <code>dir</code>, and <code>sample</code> and that when it is run it produces two Output values, namely
<code>out1</code> and <code>out2</code>.
The script can handle only a single combination of the <code>#string</code> parameters at a time, but the <code>#list</code> prefix means it can handle all existing values for out1 and out2. <code>out1</code> and <code>out2</code> will contain a list of all values.</p>
<p>Multiple inputs may be specified on one line, e.g.</p>
<pre><code>#string project,dir
</code></pre><p>You can also use this for list inputs:</p>
<pre><code>#list sample,dir
</code></pre><p>This is called &quot;Combined lists notation&quot;.
TODO: Find out what&#39;s different about this notation</p>
<h4>Resource parameters</h4><p>A Protocol can list values for resource parameters in a MOLGENIS header, e.g.</p>
<pre><code>#MOLGENIS walltime=15:00:00 nodes=1 cores=4 mem=6
</code></pre><p>The values specified in the protocol header will override the parameter values set in the parameter files.
Valid options are</p>
<pre><code>* queue
* walltime
* nodes
* ppn
* memory
</code></pre><h4>Compute properties</h4><p>Values specified on the command line as compute properties will be added to the parameter combinations and can be referenced in the Protocol Templates.</p>
<h4>Description</h4><p>A protocol can add a description in a <code>#description</code> header.</p>
<h4>Parameter mapping</h4><p>The Workflow csv file describes for each Step how the global Parameters are mapped to Protocol Inputs and Outputs. The global name is mapped to a local name that the Protocol understands.</p>
<h3>Templates</h3><h4>Types</h4><p>If your protocol file name ends with <code>.ftl</code>, the parameter values will be weaved into the steps scripts.
If it ends with <code>.sh</code>, it will be left as is and the values will be inserted at runtime.</p>
<p>If you don&#39;t want a particular section of your template to be parsed, you can surround it with <code>&lt;#noparse&gt;</code> and <code>&lt;/#noparse&gt;</code> tags.
But see (#245)[<a href="https://github.com/molgenis/molgenis-compute/issues/245">https://github.com/molgenis/molgenis-compute/issues/245</a>]</p>
<h4>Submit.sh</h4><p>The generated scripts will be accompanied by a submission script <code>submit.sh</code>. The submission script will either run the scripts locally or send them to the backend you have selected.</p>
<h4>Backends</h4><p>There are three backends</p>
<ul>
<li>localhost</li>
<li>pbs</li>
<li>slurm</li>
</ul>
<p>The difference between the backends are found in the headers and footers that get added to the Protocol templates </p>
<h3>molgenis-compute.sh</h3><h4>cleaning</h4><p>When you are done with your workflow, make sure to run </p>
<pre><code>sh molgenis-compute.sh --clean
</code></pre><p>To clean up the temporary files.</p>
<h4>Parameter override</h4><p>You can override parameter values on the command line using <code>--override</code> or <code>-o</code>. For example: <code>-o mem=6GB;queue=long</code></p>
<h3>Github workflows</h3><p>You can use workflow files that are hosted online.
Specify the command line parameter <code>--web workflowRoot</code> where workflowRoot is the URL that will be prefixed to all of the files.</p><center><br><i>See something that could be better? <a href="https://github.com/molgenis/molgenis.org/tree/master/public/pipelines/mc-hairball.md">Edit this page at Github</a></i><br></center></div></div></div></div><footer class="molgenis-docs-footer"><p>MOLGENIS and these docs are maintained by the <a href="http://www.gccgroningen.nl/about-us/people-at-the-gcc/">MOLGENIS team and collaborators</a>. <br/> Documentation source code released under the <a href="/LICENSE-MIT">MIT License</a>, documentation contents under <a href="/LICENSE-CC">CC BY 3.0</a>, and MOLGENIS software code under the <a href="/LICENSE-LGPLv3">LGPLv3 License</a>.<ul class="text-muted"><li>Version 2.0.0</li><li>·</li><li><a href="https://github.com/molgenis/molgenis">MOLGENIS Github</a></li><li>·</li><li><a href="http://github.com/molgenis/molgenis/issues">MOLGENIS Issues</a></li><li>·</li><li><a href="https://github.com/molgenis/molgenis.org/tree/master/public">Docs Github    </a></li><li>·</li><li><a href="http://github.com/molgenis/molgenis.org/issues">Docs Issues</a></li><li>·</li><li><a href="https://github.com/molgenis/molgenis/releases">Releases</a></li></ul></p></footer><script src="/res/js/prism.js"></script></body></html>